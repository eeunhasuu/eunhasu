import React, { useState, useCallback, useRef } from "react";
import { motion, AnimatePresence } from "framer-motion";

/**
 * Navbar component with a stable, hover-based dropdown menu.
 * Uses Framer Motion for smooth transitions and fixed a common issue
 * where the dropdown disappears when moving the mouse to the submenu items.
 */
function Navbar() {
  const [open, setOpen] = useState(false);
  // Ref to hold the timeout ID for closing the dropdown.
  const leaveTimeoutRef = useRef(null);

  // Handles mouse entry: opens the menu and cancels any pending close timer.
  const handleMouseEnter = useCallback(() => {
    if (leaveTimeoutRef.current) {
      clearTimeout(leaveTimeoutRef.current);
      leaveTimeoutRef.current = null;
    }
    setOpen(true);
  }, []);

  // Handles mouse leave: sets a delay before closing the menu.
  // This delay allows the mouse to enter the dropdown area without triggering closure.
  const handleMouseLeave = useCallback(() => {
    // Prevent setting multiple timeouts
    if (leaveTimeoutRef.current) return;

    const timeout = setTimeout(() => {
      setOpen(false);
      leaveTimeoutRef.current = null; // Clear ref after execution
    }, 150); // 150ms delay to cover the gap

    leaveTimeoutRef.current = timeout;
  }, []);

  // Common Tailwind classes for main navigation links (styled as buttons, not links)
  const linkClass = "cursor-pointer hover:text-blue-600 transition duration-150 p-2 -m-2 rounded-md";

  return (
    <nav className="w-full bg-white text-black border-b border-gray-200 px-6 py-4 flex items-center justify-between shadow-sm">
      {/* Left Logo */}
      <div className="text-2xl font-extrabold text-gray-800">EUNHASU</div>

      {/* Center Menu */}
      <div className="relative">
        <ul className="flex gap-8 text-lg font-medium">
          {/* Main Link (메인) */}
          <li className={linkClass}>메인</li>

          {/* Discography - Dropdown Trigger Area (디스코그래피) */}
          <li
            className="relative"
            onMouseEnter={handleMouseEnter}
            onMouseLeave={handleMouseLeave}
          >
            {/* Dropdown Trigger Text */}
            <div className={linkClass}>
              디스코그래피
            </div>

            {/* Dropdown Menu Content */}
            <AnimatePresence>
              {open && (
                <motion.ul
                  initial={{ opacity: 0, y: -10 }}
                  animate={{ opacity: 1, y: 0 }}
                  exit={{ opacity: 0, y: -10 }}
                  transition={{ duration: 0.2, ease: "easeOut" }}
                  // pt-2 is used to cover the small gap between the trigger and the dropdown.
                  className="absolute left-0 pt-2 z-20 w-40 bg-white text-black rounded-lg shadow-xl ring-1 ring-black ring-opacity-5 flex flex-col overflow-hidden"
                >
                  {/* Dropdown Items */}
                  <li className="px-4 py-2 text-sm hover:bg-blue-50 hover:text-blue-700 transition duration-150 cursor-pointer">프로듀싱</li>
                  <li className="px-4 py-2 text-sm hover:bg-blue-50 hover:text-blue-700 transition duration-150 cursor-pointer">편곡</li>
                  <li className="px-4 py-2 text-sm hover:bg-blue-50 hover:text-blue-700 transition duration-150 cursor-pointer">영상음악</li>
                  <li className="px-4 py-2 text-sm hover:bg-blue-50 hover:text-blue-700 transition duration-150 cursor-pointer">공모전</li>
                </motion.ul>
              )}
            </AnimatePresence>
          </li>

          {/* Contact Link (컨택) */}
          <li className={linkClass}>컨택</li>
        </ul>
      </div>
    </nav>
  );
}


/**
 * Main application component. Renders the Navbar in a basic container.
 * This file is ready to be used as App.jsx in a standard React project.
 */
export default function App() {
    return (
        <div className="min-h-screen bg-gray-50 font-['Inter']">
            <Navbar />
            {/* Add the rest of your page content here */}
        </div>
    );
}

import React, { useState, useCallback, useRef } from "react";
import { motion, AnimatePresence } from "framer-motion";

// 원본 Navbar 컴포넌트를 수정하여 드롭다운 및 스타일 문제를 해결합니다.
function Navbar() {
  const [open, setOpen] = useState(false);
  // 마우스가 벗어났을 때 실행될 setTimeout ID를 저장할 ref입니다.
  const leaveTimeoutRef = useRef(null);

  // 마우스 진입 핸들러: 메뉴를 열고, 혹시 실행 중인 닫기 타이머를 제거합니다.
  const handleMouseEnter = useCallback(() => {
    if (leaveTimeoutRef.current) {
      clearTimeout(leaveTimeoutRef.current);
      leaveTimeoutRef.current = null;
    }
    setOpen(true);
  }, []);

  // 마우스 이탈 핸들러: 150ms 지연 후 메뉴를 닫습니다.
  // 이 지연 시간이 메뉴 항목으로 이동하는 '틈'을 메워줍니다.
  const handleMouseLeave = useCallback(() => {
    // 이미 타이머가 설정되어 있다면 재설정하지 않도록 확인합니다.
    if (leaveTimeoutRef.current) return;

    const timeout = setTimeout(() => {
      setOpen(false);
      leaveTimeoutRef.current = null; // 타이머 실행 후 ref 초기화
    }, 150); // 150ms 딜레이
    
    leaveTimeoutRef.current = timeout;
  }, []);

  // 링크 항목에 적용할 공통 스타일입니다. 밑줄 없이 깔끔한 호버 효과를 줍니다.
  const linkClass = "cursor-pointer hover:text-blue-600 transition duration-150 p-2 -m-2 rounded-md";

  return (
    <nav className="w-full bg-white text-black border-b border-gray-200 px-6 py-4 flex items-center justify-between shadow-sm">
      {/* Left Logo */}
      <div className="text-2xl font-extrabold text-gray-800">EUNHASU</div>

      {/* Center Menu */}
      <div className="relative">
        <ul className="flex gap-8 text-lg font-medium">
          {/* 메인 - 밑줄 없이 깔끔한 버튼 스타일 적용 */}
          <li className={linkClass}>메인</li>

          {/* 디스코그래피 - Dropdown area에 onMouseEnter/onMouseLeave 적용 */}
          <li
            className="relative"
            onMouseEnter={handleMouseEnter}
            onMouseLeave={handleMouseLeave}
          >
            {/* 드롭다운 트리거 텍스트 */}
            <div className={linkClass}>
              디스코그래피
            </div>

            {/* Dropdown Menu */}
            <AnimatePresence>
              {open && (
                <motion.ul
                  initial={{ opacity: 0, y: -10 }}
                  animate={{ opacity: 1, y: 0 }}
                  exit={{ opacity: 0, y: -10 }}
                  transition={{ duration: 0.2, ease: "easeOut" }}
                  // pt-2를 사용하여 트리거와 드롭다운 사이의 간격을 커버합니다.
                  className="absolute left-0 pt-2 z-20 w-40 bg-white text-black rounded-lg shadow-xl ring-1 ring-black ring-opacity-5 flex flex-col overflow-hidden"
                >
                  {/* 드롭다운 항목들 */}
                  <li className="px-4 py-2 text-sm hover:bg-blue-50 hover:text-blue-700 transition duration-150 cursor-pointer">프로듀싱</li>
                  <li className="px-4 py-2 text-sm hover:bg-blue-50 hover:text-blue-700 transition duration-150 cursor-pointer">편곡</li>
                  <li className="px-4 py-2 text-sm hover:bg-blue-50 hover:text-blue-700 transition duration-150 cursor-pointer">영상음악</li>
                  <li className="px-4 py-2 text-sm hover:bg-blue-50 hover:text-blue-700 transition duration-150 cursor-pointer">공모전</li>
                </motion.ul>
              )}
            </AnimatePresence>
          </li>

          {/* 컨택 - 밑줄 없이 깔끔한 버튼 스타일 적용 */}
          <li className={linkClass}>컨택</li>
        </ul>
      </div>
    </nav>
  );
}


// 전체 애플리케이션 컴포넌트
export default function App() {
    return (
        <div className="min-h-screen bg-gray-50 p-8 font-['Inter']">
            <div className="max-w-4xl mx-auto">
                <header className="mb-12 text-center">
                    <h1 className="text-3xl font-bold text-gray-800">React Navigation Fix Example</h1>
                    <p className="text-gray-500 mt-2">
                        디스코그래피 메뉴에서 마우스가 메뉴 항목으로 이동하는 동안 드롭다운이 닫히지 않도록 수정되었습니다.
                    </p>
                </header>
                <Navbar />
                <div className="mt-16 p-6 bg-white border border-gray-200 rounded-xl shadow-lg">
                    <h2 className="text-xl font-semibold text-gray-700 mb-4">수정 사항 요약</h2>
                    <ul className="list-disc list-inside space-y-2 text-gray-600">
                        <li>**드롭다운 안정화:** `onMouseLeave`에 150ms의 지연 시간 (`setTimeout`)을 적용하여 메뉴 항목으로 마우스가 이동하는 짧은 간격을 커버했습니다.</li>
                        <li>**링크 스타일 개선:** `메인`과 `컨택` 항목에 `hover:text-blue-600` 클래스를 추가하여 밑줄 없이 깔끔하고 반응성 좋은 버튼처럼 보이도록 변경했습니다.</li>
                        <li>`useCallback`과 `useRef`를 사용하여 성능 최적화를 진행했습니다.</li>
                    </ul>
                </div>
            </div>
        </div>
    );
}
